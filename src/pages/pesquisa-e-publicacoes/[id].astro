---
import InsideLayout from "@layouts/InsideLayout.astro"
import H1TitleWithLine from "@components/H1TitleWithLine.astro"
import { getCollection, render } from "astro:content"

// Let's call getCollection() inside of getStaticPaths() to have our collection data available for building static routes.
// Then, we create the individual URL paths using the id property of each content entry.
// Each page is passed the entire collection entry as a prop for use in your page template.
export async function getStaticPaths() {
  const pesquisas = await getCollection("pesquisa", ({ data }) => {
    // We only want the itens that aren't pdf files nor external links:
    return (
      typeof data.arquivo_pdf === "undefined" &&
      typeof data.link_externo === "undefined"
    )
  })
  const staticPathsAndProps = pesquisas.map((pesquisa) => {
    return {
      params: { id: pesquisa.id },
      props: { pesquisa },
    }
  })
  return staticPathsAndProps
}

// For a specific item, we get meta info and render the content in a component called `Content`:
const canonicalURL = new URL(Astro.url.pathname, Astro.site)
const { pesquisa } = Astro.props
const { Content } = await render(pesquisa)
const preTitle = "Pesquisa e publicações"
const title = pesquisa.data.titulo
---

<InsideLayout
  title={preTitle + " / " + title}
  description={pesquisa.data.descricao}
  canonicalURL={canonicalURL}
>
  <H1TitleWithLine preTitle={preTitle} title={title} />
  <article>
    <Content />
  </article>
</InsideLayout>
