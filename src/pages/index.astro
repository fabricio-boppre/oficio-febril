---
import { css } from "@styled-system/css"
import { flex } from "@styled-system/patterns"
import BasicLayout from "../layouts/BasicLayout.astro"
import HeaderTitle from "@components/HederTitle.astro"
import NavMenu from "@components/NavMenu.astro"
import { getCollection } from "astro:content"

const canonicalURL = new URL(Astro.url.pathname, Astro.site)
const allCliches = await getCollection("cliches")
const allClichesSimplified = allCliches.flatMap((cliche) => ({
  titulo: cliche.data.titulo,
  descricao: cliche.data.descricao,
  imagemSrc: cliche.data.imagem.src,
}))
---

<BasicLayout
  title="página inicial"
  description="[aguardando]"
  canonicalURL={canonicalURL}
>
  <header
    class={flex({
      minH: "calc(100vh - var(--spacing-header-and-footer-y-margin))",
      layerStyle: "headerLayout",
    })}
  >
    <HeaderTitle />
    <NavMenu />
    <div
      id="cliche"
      class={flex({
        maxW: "maxWidth",
        alignItems: "center",
        justifyContent: "center",
        m: "0 auto",
        p: "20px",
        flex: "1 0 auto",
      })}
    >
    </div>
  </header>
  <main class={css({ layerStyle: "mainLayout" })}>
    <div class={css({ bgColor: "green" })}>
      <h1
        class={css({
          fontSize: "3rem",
        })}
      >
        Destaques
      </h1>
    </div>
    <div class={css({ bgColor: "blue" })}>
      <h1
        class={css({
          fontSize: "3rem",
        })}
      >
        As últimas
      </h1>
    </div>
    <div class={css({ bgColor: "orange" })}>
      <h1
        class={css({
          fontSize: "3rem",
        })}
      >
        Artistas
      </h1>
    </div>

    <slot />
  </main>
</BasicLayout>

<script define:vars={{ allClichesSimplified }}>
  var randomCliche =
    allClichesSimplified[
      Math.floor(Math.random() * allClichesSimplified.length)
    ]
  const clicheImgDiv = document.getElementById("cliche")
  var img = document.createElement("img")
  img.src = randomCliche.imagemSrc
  img.alt = randomCliche.titulo + ", " + randomCliche.descricao
  clicheImgDiv.appendChild(img)
</script>
